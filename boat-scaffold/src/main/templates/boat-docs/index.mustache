<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>{{{appName}}}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="UTF-8" />
  {{>js_jquery}}
  {{>js_prettify}}
  {{>js_bootstrap}}
  {{>marked}}
  <script>

      if (!library)
          var library = {};

      library.json = {
          replacer: function(match, pIndent, pKey, pVal, pEnd) {
              var key = '<span class=json-key>';
              var val = '<span class=json-value>';
              var str = '<span class=json-string>';
              var r = pIndent || '';
              if (pKey)
                  r = r + key + pKey.replace(/[": ]/g, '') + '</span>: ';
              if (pVal)
                  r = r + (pVal[0] == '"' ? str : val) + pVal + '</span>';
              return r + (pEnd || '');
          },
          prettyPrint: function(obj) {
              var jsonLine = /^( *)("[\w]+": )?("[^"]*"|[\w.+-]*)?([,[{])?$/mg;
              return JSON.stringify(obj, null, 3)
                      .replace(/&/g, '&amp;').replace(/\\"/g, '&quot;')
                      .replace(/</g, '&lt;').replace(/>/g, '&gt;')
                      .replace(jsonLine, library.json.replacer);
          }
      };

    $( document ).ready(function() {
      marked.setOptions({
        renderer: new marked.Renderer(),
        gfm: true,
        tables: true,
        breaks: false,
        pedantic: false,
        sanitize: false,
        smartLists: true,
        smartypants: false
      });

      var textFile = null;

      /// Function to be used to download a text json schema
      function makeTextFile(text) {

        var data = new Blob([text], {type: 'text/plain'});

        // If we are replacing a previously generated file we need to
        // manually revoke the object URL to avoid memory leaks.
        if (textFile !== null) {
          window.URL.revokeObjectURL(textFile);
        }

        textFile = window.URL.createObjectURL(data);

        var a = document.createElement("a");
        document.body.appendChild(a);
        a.style = "display: none";
        a.href = textFile;
        a.download = 'schema.txt';
        a.click();

        return textFile;
      };

      /// TODO: Implement resizing for expanding within iframe
      function callResize() {
        window.parent.postMessage('resize', "*");
      }

      function processMarked() {
        $(".marked").each(function() {
          $(this).html(marked($(this).html()));
        });
      }

      // Bootstrap Scrollspy
      $(this).scrollspy({ target: '#scrollingNav', offset: 18 });

      // Content-Scroll on Navigation click.
      $('.sidenav').find('a').on('click', function(e) {
          e.preventDefault();
          var id = $(this).attr('href');
          if ($(id).length > 0)
              $('html,body').animate({ scrollTop: parseInt($(id).offset().top) }, 400);
          window.location.hash = $(this).attr('href');
      });

      // Quickjump on Pageload to hash position.
      if(window.location.hash) {
          var id = window.location.hash;
          if ($(id).length > 0)
              $('html,body').animate({ scrollTop: parseInt($(id).offset().top) }, 0);
      }


      function initDynamic() {
        // tabs
        $('.nav-tabs-examples a').click(function (e) {
            e.preventDefault();
            $(this).tab('show');
        });


        $('.nav-tabs-examples').find('a:first').tab('show');

        // call scrollspy refresh method
        $(window).scrollspy('refresh');
      }

      initDynamic();

      // Pre- / Code-Format
      prettyPrint();

      //Convert elements with "marked" class to markdown
      processMarked();
    });

    function findNode(id, currentNode) {
        return (Object.keys(currentNode)[0] === id) ? currentNode : findNodeInChildren(id, currentNode);
    }

    function findNodeInChildren(id, currentNode) {
        for (let prop in currentNode) {
            if (currentNode.hasOwnProperty(prop)) {
                let currentChild = currentNode[prop];
                if (id === prop) {
                    return currentChild;
                } else {
                    // Search in the current child
                    if (typeof (currentChild) === 'object') {
                        let result = findNode(id, currentChild);
                        if (result !== false) {
                            return result;
                        }
                    }
                }
            }
        }
        return false;
    }

  </script>
  <style type="text/css">
    {{>fonts}}

    {{>css_bootstrap}}
    {{>css_prettify}}
      {{>css_json_schema_view}}

    {{>styles}}
  </style>
</head>
<body>
  <script>
    // Script section to load models into a JS Var
    var defs = {}
    {{#models}}
    {{#model}}
    <!-- Sometimes classname is referred.. -->
    defs["{{classname}}"] = {{{modelJson}}};
    <!-- Sometimes name is referred.. -->
    defs["{{name}}"] = {{{modelJson}}};
    <!-- maybe we should just buy some cows and a field... -->
    {{/model}}
    {{/models}}

    var errs = {};
    {{#swagger.vendorExtensions.x-shared-errors}}
    {
      let err = {{{.}}};
      errs[err.errorID] = err;
    }
    {{/swagger.vendorExtensions.x-shared-errors}}
  </script>
  <div class="container-fluid">
    <div class="row-fluid">
      <div id="sidenav" class="span2">
        <nav id="scrollingNav">
          <ul class="sidenav nav nav-list">
            <!-- Logo Area -->
<!--              <div style="width: 80%; background-color: #4c8eca; color: white; padding: 20px; text-align: center; margin-bottom: 20px; ">-->

<!--              API Docs 2-->

<!--              </div>-->
<!--            -->
              <h1 class="nav-header">{{appName}}</h1>

              <li class="nav-fixed nav-header active" data-group="_"><a href="#api-_">Summary</a></li>

            {{#apiInfo}}
              {{#apis}}
                {{#operations}}
                  <li class="nav-header" data-group="{{baseName}}"><a href="#api-{{baseName}}">API Methods - {{baseName}}</a></li>
                  {{#operation}}
                    <li data-group="{{baseName}}" data-name="{{nickname}}" class="">
                        <a href="#api-{{baseName}}-{{nickname}}" title="{{summary}}">
                            <span class="prettyprint language-html" data-type="{{httpMethod}}">{{httpMethod}}</span>
                            {{#summary}}
                                {{summary}}
                            {{/summary}}
                            {{^summary}}
                                {{nickname}}
                            {{/summary}}
                        </a>
                    </li>
                  {{/operation}}
                {{/operations}}
              {{/apis}}
            {{/apiInfo}}
          </ul>
        </nav>
      </div>
      <div id="content">
        <div id="project">
          <div class="pull-left">
            <h1>{{{appName}}}</h1>
              {{#version}}
                  <div class="app-desc">Version: {{{version}}}</div>
              {{/version}}
          </div>
          <div class="clearfix"></div>
        </div>
        <div id="header">
          <div id="api-_">
            <div id="app-description" class="app-desc">
                {{{appDescription}}}
            </div>
          </div>
        </div>
        <div id="sections">
          {{#apiInfo}}
            {{#apis}}
              {{#operations}}
                <section id="api-{{baseName}}">
                  <h1>{{baseName}}</h1>
                  {{#operation}}
                    <div id="api-{{baseName}}-{{nickname}}">
                      <article id="api-{{baseName}}-{{nickname}}-0" data-group="User" data-name="{{nickname}}" data-version="0">
                          <div class="pull-left">
                              {{#summary}}<h1>{{.}}</h1>{{/summary}}
                              {{#description}}<p>{{description}}</p>{{/description}}

                          </div>

                          <div class="pull-right"></div>
                        <div class="clearfix"></div>
                        <p class="marked">{{notes}}</p>
                          <br/>
                          {{#vendorExtensions}}
                              <div class="secured-by">
                                  <h2>Secured by Backbase Access Control</h2>
                                  {{#x-BbAccessControl-resource}}<pre><b>Resource:</b> {{.}}</pre>{{/x-BbAccessControl-resource}}
                                  {{#x-BbAccessControl-function}}<pre><b>Function:</b> {{.}}</pre>{{/x-BbAccessControl-function}}
                                  {{#x-BbAccessControl-privilege}}<pre><b>Privilege:</b> {{.}}</pre>{{/x-BbAccessControl-privilege}}
                              </div>
                          {{/vendorExtensions}}
                          <pre class="prettyprint language-html prettyprinted" data-type="{{httpMethod}}"><code><span class="pln">{{path}}</span></code></pre>

                          {{#hasAuthMethods}}
                              <h2>Scopes</h2>
                              <table>
                                {{#authMethods}}{{#scopes}}
                                  <tr>
                                    <td>{{scope}}</td>
                                    <td>{{description}}</td>
                                  </tr>
                                {{/scopes}}{{/authMethods}}
                              </table>
                          {{/hasAuthMethods}}

                          {{#hasPathParams}}
                            <div class="methodsubtabletitle">Path parameters</div>
                            <table id="methodsubtable">
                                {{#pathParams}}
                                  {{>param}}
                                {{/pathParams}}
                            </table>
                          {{/hasPathParams}}

                          {{#hasHeaderParams}}
                            <div class="methodsubtabletitle">Header parameters</div>
                            <table id="methodsubtable">
                              {{#headerParams}}
                                  {{>param}}
                              {{/headerParams}}
                            </table>
                          {{/hasHeaderParams}}

                          {{#hasFormParams}}
                            <div class="methodsubtabletitle">Form parameters</div>
                            <table id="methodsubtable">
                              {{#formParams}}
                                  {{>param}}
                              {{/formParams}}
                            </table>
                          {{/hasFormParams}}

                          {{#hasQueryParams}}
                            <div class="methodsubtabletitle">Query parameters</div>
                            <table id="methodsubtable">
                              {{#queryParams}}
                                {{>param}}
                              {{/queryParams}}
                            </table>
                          {{/hasQueryParams}}

                          {{#hasBodyParam}}
                              <h2>Request Body Schema</h2>
                              {{#bodyParams}}
                                  {{>paramB}}
                              {{/bodyParams}}

                          {{/hasBodyParam}}

                          <h2>Responses</h2>
                          {{#responses}}
                            <h3 id="examples-{{baseName}}-{{nickname}}-title-{{code}}"></h3>
                            <p id="examples-{{baseName}}-{{nickname}}-description-{{code}}" class="marked"></p>
                            <script>
                              var response{{baseName}}{{code}}_description = `{{{message}}}`;
                              var response{{baseName}}{{code}}_description_break = response{{baseName}}{{code}}_description.indexOf('\n');
                              if (response{{baseName}}{{code}}_description_break == -1) {
                                $("#examples-{{baseName}}-{{nickname}}-title-{{code}}").text("Status: {{code}} - " + response{{baseName}}{{code}}_description);
                              } else {
                                $("#examples-{{baseName}}-{{nickname}}-title-{{code}}").text("Status: {{code}} - " + response{{baseName}}{{code}}_description.substring(0, response{{baseName}}{{code}}_description_break));
                                $("#examples-{{baseName}}-{{nickname}}-description-{{code}}").html(response{{baseName}}{{code}}_description.substring(response{{baseName}}{{code}}_description_break));
                              }
                            </script>


                            <ul id="responses-detail-{{baseName}}-{{nickname}}-{{code}}" class="nav nav-tabs nav-tabs-examples" >
                              {{#schema}}
                                <li class="active">
                                  <a data-toggle="tab" href="#responses-{{baseName}}-{{nickname}}-{{code}}-schema">Schema</a>
                                </li>

                                {{#examples}}
                                  <li class="">
                                    <a data-toggle="tab" href="#responses-{{baseName}}-{{nickname}}-{{code}}-example">Response Example</a>
                                  </li>
                                {{/examples}}

                              {{/schema}}

                              {{#hasHeaders}}
                                <li class="">
                                  <a data-toggle="tab" href="#responses-{{nickname}}-{{code}}-headers">Headers</a>
                                </li>
                              {{/hasHeaders}}

                              {{#vendorExtensions}}
                                {{#x-shared-errors}}
                                  <script>
                                    $(document).ready(function()
                                    {
                                      var errRef = "{{{$ref}}}";
                                      var errorID = errRef.substring(errRef.lastIndexOf("/") + 1);
                                      var errorDef = errs[errorID];
                                      var tabID = 'responses-detail-{{baseName}}-{{nickname}}-{{code}}-' + errorID;
                                      var contentID = tabID + "-content";

                                      $('#responses-detail-{{baseName}}-{{nickname}}-{{code}}').append("<li><a href='#" + tabID + "' data-toggle='tab'>" + errorID + "</a></li>");
                                      var contentWrapper = $('#responses-{{baseName}}-{{nickname}}-{{code}}-wrapper');
                                      contentWrapper.append('<div class="tab-pane" id="' + tabID + '"><div id="' + contentID + '" class="exampleStyle"></div></div>');
                                      var contentPane = $('#' + contentID);

                                      contentPane.append('<p>' + errorDef.message + '</p>');
                                      if (errorDef.variables)
                                      {
                                        contentPane.append('<h4>Variables</h4>');
                                        var lVars = $('<ol></ol>').appendTo(contentPane);
                                        for (lii = 0; lii < errorDef.variables.length; lii++)
                                        {
                                          $("<li></li>").appendTo(lVars).text(errorDef.variables[lii]);
                                        }
                                      }
                                    });
                                  </script>
                                {{/x-shared-errors}}
                              {{/vendorExtensions}}
                            </ul>


                            <div class="tab-content exampleStyle" id="responses-{{baseName}}-{{nickname}}-{{code}}-wrapper" style='margin-bottom: 10px;'>
                              {{#schema}}
                                <div class="tab-pane active " id="responses-{{baseName}}-{{nickname}}-{{code}}-schema">
                                  <div id="responses-{{baseName}}-{{nickname}}-schema-{{code}}">
                                    <script>
                                      $(document).ready(function() {
                                        var schemaWrapper = {{{jsonSchema}}};
                                        var schema = findNode('schema', schemaWrapper.content).schema;

                                        if (!schema) {
                                          schema = schemaWrapper.schema;
                                        }
                                        if (schema.$ref != null) {
                                          schema = defsParser.$refs.get(schema.$ref);
                                          if (schema.type === 'array' && schema.items != null && schema.items.$ref != null) {
                                              schema.items = defsParser.$refs.get(schema.items.$ref);


                                          }
                                        }else if (schema.type === 'array' && schema.items != null && schema.items.$ref != null) {
                                          schema.items = defsParser.$refs.get(schema.items.$ref);
                                        } else {
                                          schemaWrapper.definitions = Object.assign({}, defs);
                                          $RefParser.dereference(schemaWrapper).catch(function(err) {
                                            console.log(err);
                                          });
                                        }

                                         if (schema && schema.allOf) {
                                            schema.allOf = schema.allOf.map( i =>  i.$ref ? defsParser.$refs.get(i.$ref) : i).filter(Boolean);
                                            schema = mergeAllOf(schema,  {
                                              resolvers: {
                                                defaultResolver: mergeAllOf.options.resolvers.title
                                              }
                                            });
                                          }

                                         if (schema.items && schema.items.allOf) {
                                            schema.items.allOf = schema.items.allOf.map( i =>  i.$ref ? defsParser.$refs.get(i.$ref) : i).filter(Boolean);
                                            schema.items = mergeAllOf(schema.items,  {
                                              resolvers: {
                                                defaultResolver: mergeAllOf.options.resolvers.title
                                              }
                                            });
                                          }

                                        var view = new JSONSchemaView(schema, 3);
                                        $('#responses-{{baseName}}-{{nickname}}-{{code}}-schema-data').val(JSON.stringify(schema));
                                        var result = $('#responses-{{baseName}}-{{nickname}}-schema-{{code}}');
                                        result.empty();
                                        result.append(view.render());
                                      });
                                    </script>
                                  </div>
                                  <input id='responses-{{baseName}}-{{nickname}}-{{code}}-schema-data' type='hidden' value=''></input>
                                </div>
                                {{#examples}}
                                  <div class="tab-pane" id="examples-{{baseName}}-{{nickname}}-{{code}}-example">
                                    <pre class="prettyprint"><code class="json">{{example}}</code></pre>
                                  </div>
                                {{/examples}}
                              {{/schema}}
                              {{#hasHeaders}}
                                  <div class="tab-pane" id="responses-{{nickname}}-{{code}}-headers">
                                      <table>
                                          <tr>
                                              <th width="150px">Name</th>
                                              <th width="100px">Type</th>
                                              <th width="100px">Format</th>
                                              <th>Description</th>
                                          </tr>
                                          {{#headers}}
                                              <tr>
                                                  <td>{{#baseName}}{{baseName}}{{/baseName}}</td>
                                                  <td>{{#datatype}}{{dataType}}{{/datatype}}</td>
                                                  <td>{{#dataFormat}}{{dataFormat}}{{/dataFormat}}</td>
                                                  <td>{{#description}}{{description}}{{/description}}</td>
                                              </tr>
                                          {{/headers}}
                                      </table>
                                  </div>
                              {{/hasHeaders}}
                            </div>
                          {{/responses}}
                        </article>
                      </div>
                      <hr>
                    {{/operation}}
                  </section>
                {{/operations}}
              {{/apis}}
            {{/apiInfo}}
          </div>
          <div id="footer">
            <div id="api-_footer">
              <p>Suggestions, contact, support and error reporting;
                {{#infoUrl}}
                  <div class="app-desc">Information URL: <a href="{{{infoUrl}}}">{{{infoUrl}}}</a></div>
                {{/infoUrl}}
                {{#infoEmail}}
                  <div class="app-desc">Contact Info: <a href="{{{infoEmail}}}">{{{infoEmail}}}</a></div>
                {{/infoEmail}}
              </p>
              {{#licenseInfo}}
                <div class="license-info">{{{licenseInfo}}}</div>
              {{/licenseInfo}}
              {{#licenseUrl}}
                <div class="license-url">{{{licenseUrl}}}</div>
              {{/licenseUrl}}
            </div>
          </div>
{{^hideGenerationTimestamp}}          <div id="generator">
            <div class="content">
              Generated {{generatedDate}}
            </div>
          </div>
{{/hideGenerationTimestamp}}      </div>
    </div>
  </div>
  {{>js_jsonformatter}}
  {{>js_jsonschemaview}}
  {{>js_json_schema_ref_parser}}
  {{>js_jsonschemamergeallof}}
  {{>js_json_stringify_safe}}
  {{>js_webfontloader}}
  <script>
    var $RefParser = JsonSchemaRefParser;
    var schemaWrapper = { "components": { "schemas" : defs}};
    defsParser = new $RefParser();
    defsParser.dereference(schemaWrapper).catch(function(err) {
      console.log(err);
    });
  </script>
  <script>
  $(document).ready(function () {
    $('.nav-tabs-examples').find('a:first').tab('show');
    $(this).scrollspy({ target: '#scrollingNav', offset: 18 });
  });
  </script>
  <script>

       // To handle the examples
       $(document).ready(function() {
          $('.dropdown-examples').each(function() {
            $(this).find('.example-dropdown-value:first').show();
          });
          $('.example-dropdown-select').change(function() {
            $(this).parent().parent().find('.example-dropdown-value').hide();
            $(`.dropdown-examples div${this.value}`).show();
          });
       });
    </script>
</body>
</html>
